## 项目介绍

本项目为一个基于多落地方向的同步&异步日志系统，其主要支持功能如下：

- 支持多级别的日志消息输出
- 支持同步和异步的日志输出
- 支持可靠的将日志输出到标准输出、文件以及滚动文件中（支持扩展落地方向）
- 支持多线程程序并发安全的写日志

## 核心技术

- C++11（线程库、智能指针、右值引用、lambda表达式、范围for、auto等）
- 类的层次设计（继承和多态的应用）
- 多线程的同步与互斥
- 生产者消费者模型
- 双缓冲区设计思想
- 单例模式设计思想

## 模块划分：

- **日志等级模块：**

  定义出日志系统所包含的所有日志等级

  - DEBUG,调试等级的日志
  - INFO,    提示等级的日志
  - WARN,  警告等级的日志
  - ERROR. 错误等级的日志
  - FATAL,  致命错误等级的日志
  - OFF，   不输出日志

  提供一个接口，将日志等级转换为一个对应的字符串：DEBUG —>"DEBUGT

- **日志格式化和日志消息模块：**

  日志消息类：其存储一条日志中所需的所有内容

  - 日志的输出时间
  - 日志等级
  - 源文件名称
  - 源代码行号
  - 线程ID
  - 日志主体消息
  - 日志器名称

  日志格式化类：根据日志输出格式对日志消息进行格式化

  - %D 日期 (年月日)
  - %T 时间 (时分秒)
  - %t 缩进
  - %i 线程id
  - %L 日志级别
  - %N 日志器名称
  - %f 文件名
  - %l 行号
  - %m 日志消息
  - %n 换行
  - %% 表示一个'%'字符

- **日志落地模块：**

  抽象出日志落地基类，通过日志落地基类派生出各个落地方向子类，在不同的子类中实现不同的日志落地方向
  已实现的落地方向：（日志落地方向子类内部在进行日志落地时保证了线程安全）

  - 标准输出落地
  - 指定文件落地
  - 滚动文件落地（根据文件大小自动切换日志的输出文件）

  支持自行按需扩展出更多的落地方向子类

- **缓冲区模块：**

  缓冲区中每个元素的组成如下：

  - 日志消息字符串
  - 具体日志落地类对象

  将来通过日志落地类对象将日志消息字符串中的内容进行实际的输出
  缓冲区的组成如下：

  - 一个大数组
  - 一个读指针
  - 一个写指针

  缓冲区提供的操作如下

  - push——向缓冲区中插入数据
  - pop——从缓冲区中拿取数据
  - is_full——判断缓冲区是否为满
  - is_empty——判断缓冲区是否为空
  - swap——交换两个缓冲区内部的成员
  - reset——将缓冲区中的读写指针置0

- **异步工作线程池模块：**

  异步工作线程池设计为单例模式，其根据生产者消费者模型实现，采用双缓冲区的设计
  所有的异步日志器共用同一个异步工作线程池，实现时保证了其内部操作的线程安全
  其内部主要成员有：

  - 基于缓冲区模块设计的双缓冲区
  - 管理所有异步工作线程的数组
  - 维护线程同步与互斥关系所需的互斥锁和条件变量

  其对外主要就是提供一个push方法和一个获取单例对象的方法，使用时外部需先获取单例对象，再通过其进行数据的插入

- **日志器模块：**

  先抽象出日志器基类，再分别派生出同步日志器和异步日志器子类，在不同的日志器子类中分别实现不同种类的日志落地
  日志器模块的功能主要是对前边所有实现的模块进行整合，最终向用户提供相应的调用接口
  
  为了对所有已经创建的日志器进行管理还实现了日志器管理者类，该类实现为单例模式，所有的日志器都以名字作为唯一标识，全局内均有效，将来用户只能通过日志器管理者来添加和获取日志器，从而达到对日志器全局范围内管理

## 开发环境及使用的工具

- Ubuntu 24.04
- VScode/vim
- g++/gdb
- Makefile

本项目不依赖任何第三方库，只需要Linux环境和相应的开发工具即可开发运行

## 项目使用说明

- 本项目环境搭建好后可以直接引入使用
- 使用样例演示参照example.cc文件

## 性能测试

- 测试环境：
  2核CPU、2G内存的轻量化云服务进行的测试

- 测试方法：
  使用3个日志输出线程同时进行日志的输出，完成总量为1百万条的日志输出，每条日志大小均为100字节，日志输出到指定的文件中，异步工作线程池中的工作线程设定为2个，异步工作线程池的单个缓冲区最大可容纳日志条数设定为4096条

- 测试结果：（对于异步日志器只计算日志输出到异步线程池所提供的缓冲区中的时间，并不计算日志实际落入文件中的时间）

  - 同步日志器的测试结果：
  
    线程1输出：333334条日志 耗时: 2.53541s
  
    线程2输出：333333条日志 耗时: 2.67748s
  
    线程3输出：333333条日志 耗时: 2.61237s
  
    总输出日志条数: 1000000条

    总输出日志大小: 95MB
  
    总消耗时间: 2.67761s
  
    平均每秒输出日志条数: 373466条
  
    平均每秒输出日志大小: 35MB
  
  - 异步日志器的测试结果：
  
    线程1输出：333334条日志 耗时: 2.37868s
  
    线程2输出：333333条日志 耗时: 2.43031s
  
    线程3输出：333333条日志 耗时: 2.44578s
  
    总输出日志条数: 1000000条
  
    总输出日志大小: 95MB
  
    总消耗时间: 2.44599s
  
    平均每秒输出日志条数: 408832条
  
    平均每秒输出日志大小: 38MB
  
  

日志测试的实现代码就在performance_test.cc文件中，用户可在不同的环境下自行进行性能测试